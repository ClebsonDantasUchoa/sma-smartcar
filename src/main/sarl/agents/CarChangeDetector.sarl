package agents

import events.CarChange
import io.sarl.core.Destroy
import io.sarl.core.Initialize
import io.sarl.core.Logging
import models.CarPreference
import service.CarPreferenceService
import api.SmartCarAPI

agent CarChangeDetector {
	uses Logging
	var carPreference : CarPreference = CarPreference.getInstance()
	var smartCarAPI : SmartCarAPI = new SmartCarAPI()
	var jsonString : String

	on Initialize {
		
		info("The agent was started.")
	}

	on Destroy {
		
		info("The agent was stopped.")
	}
	
	on CarChange{
		println("------------CarChange detected on CarChangeDetector agent---------")
		jsonString = new CarPreferenceService().convertCarPreferenceToJsonString(carPreference)
		smartCarAPI.saveCarChange(jsonString)
		println("")
	}

}
